{"version":3,"file":"bundle.js","sources":["/var/www/dev/EventDrops/node_modules/browserify/node_modules/browser-pack/_prelude.js","/var/www/dev/EventDrops/lib/main.js","/var/www/dev/EventDrops/lib/eventDrops.js","/var/www/dev/EventDrops/lib/eventLine.js","/var/www/dev/EventDrops/lib/util/configurable.js","/var/www/dev/EventDrops/lib/delimiter.js","/var/www/dev/EventDrops/lib/filterData.js"],"names":["eventDrops","require","define","amd","d3","chart","window","module","exports","configurable","eventLine","defaultConfig","start","Date","end","width","margin","top","left","bottom","right","locale","tickFormat","delimiter","hasTopAxis","hasBottomAxis","data","length","eventColor","config","eventDropGraph","selection","each","updateZoom","event","sourceEvent","toString","zoom","translate","scale","redraw","redrawDelimiter","svg","select","remove","append","classed","attr","graphWidth","call","xScale","dateFormat","timeFormat","time","format","drawXAxis","where","xAxis","axis","orient","y","parseInt","graphHeight","graph","size","height","graphBody","lines","selectAll","enter","d","yScale","name","style","exit","behavior","center","on","this","yDomain","yRange","forEach","index","push","domain","range","yAxisEl","yTick","x","ordinal","key","filterData","text","count","dates","circle","targetFunction","listeners","item","value","arguments","hasOwnProperty","limits","filteredData","boundary","min","max","datum"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\n\nvar eventDrops = require('./eventDrops');\n\nif (typeof define === \"function\" && define.amd) {\n  define('d3.chart.eventDrops', [\"d3\"], function (d3) {\n    d3.chart = d3.chart || {};\n    d3.chart.eventDrops = eventDrops(d3);\n  });\n} else if (window) {\n  window.d3.chart = window.d3.chart || {};\n  window.d3.chart.eventDrops = eventDrops(window.d3);\n} else {\n  module.exports = eventDrops;\n}\n","\"use strict\";\n\nvar configurable = require('./util/configurable');\nvar eventLine = require('./eventLine');\n\nmodule.exports = function (d3) {\n\n  var defaultConfig = {\n    start: new Date(0),\n    end: new Date(),\n    width : 1400,\n    margin: {\n      top: 60,\n      left: 280,\n      bottom: 40,\n      right: 50,\n    },\n    locale: null,\n    tickFormat: null,\n    delimiter: require('./delimiter'),\n    hasTopAxis: true,\n    hasBottomAxis: function (data) {\n      return data.length >= 10;\n    },\n    eventColor: 'black'\n  };\n\n  return function eventDrops(config) {\n    var xScale = d3.time.scale();\n    var yScale = d3.scale.ordinal();\n    config = config || {};\n    for (var key in defaultConfig) {\n      config[key] = config[key] || defaultConfig[key];\n    };\n\n    function eventDropGraph(selection) {\n      selection.each(function (data) {\n        var zoom = d3.behavior.zoom().center(null).on(\"zoom\", updateZoom);\n\n        if (config.delimiter) {\n          zoom.on(\"zoomend\", redrawDelimiter);\n        }\n        var graphWidth = config.width - config.margin.right - config.margin.left;\n        var graphHeight = data.length * 40;\n        var height = graphHeight + config.margin.top + config.margin.bottom;\n\n        d3.select(this).select('svg').remove();\n\n        var svg = d3.select(this)\n          .append('svg')\n          .attr('width', config.width)\n          .attr('height', height)\n        ;\n\n        var graph = svg.append('g')\n          .attr('transform', 'translate(0, 25)');\n\n        var yDomain = [];\n        var yRange = [];\n\n        data.forEach(function (event, index) {\n          yDomain.push(event.name);\n          yRange.push(index * 40);\n        });\n\n        yScale.domain(yDomain).range(yRange);\n\n        var yAxisEl = graph.append('g')\n          .classed('y-axis', true)\n          .attr('transform', 'translate(0, 60)');\n\n        var yTick = yAxisEl.append('g').selectAll('g').data(yDomain);\n\n        yTick.enter()\n          .append('g')\n          .attr('transform', function(d) {\n            return 'translate(0, ' + yScale(d) + ')';\n          })\n          .append('line')\n          .classed('y-tick', true)\n          .attr('x1', config.margin.left)\n          .attr('x2', config.margin.left + graphWidth);\n\n        yTick.exit().remove();\n\n        svg\n          .append('rect')\n          .call(zoom)\n          .classed('zoom', true)\n          .attr('width', graphWidth)\n          .attr('height', height )\n          .attr('transform', 'translate(' + config.margin.left + ', 35)')\n        ;\n\n        xScale.range([0, graphWidth]).domain([config.start, config.end]);\n\n        zoom.x(xScale);\n\n        function updateZoom() {\n          if (d3.event.sourceEvent.toString() === '[object MouseEvent]') {\n            zoom.translate([d3.event.translate[0], 0]);\n          }\n\n          if (d3.event.sourceEvent.toString() === '[object WheelEvent]') {\n            zoom.scale(d3.event.scale);\n          }\n\n          redraw();\n        }\n\n        function redrawDelimiter() {\n          svg.select('.delimiter').remove();\n          var delimiterEl = svg\n            .append('g')\n            .classed('delimiter', true)\n            .attr('width', graphWidth)\n            .attr('height', 10)\n            .attr('transform', 'translate(' + config.margin.left + ', 15)')\n            .call(config.delimiter({xScale: xScale, dateFormat: config.locale ? config.locale.timeFormat(\"%d %B %Y\") : d3.time.format(\"%d %B %Y\")}))\n          ;\n        }\n\n        function drawXAxis(where) {\n          var xAxis = d3.svg.axis()\n            .scale(xScale)\n            .orient(where)\n          ;\n\n          if (config.tickFormat) {\n            xAxis.tickFormat(config.tickFormat);\n          }\n          var y = (where == 'bottom' ? parseInt(graphHeight) : 0) + 20;\n\n          graph.select('.x-axis.' + where).remove();\n          var xAxisEl = graph\n            .append('g')\n            .classed('x-axis', true)\n            .classed(where, true)\n            .attr('transform', 'translate(' + config.margin.left + ', ' + y + ')')\n            .call(xAxis)\n          ;\n        }\n\n        function redraw() {\n\n          var hasTopAxis = typeof config.hasTopAxis === 'function' ? config.hasTopAxis(data) : config.hasTopAxis;\n          if (hasTopAxis) {\n            drawXAxis('top');\n          }\n\n          var hasBottomAxis = typeof config.hasBottomAxis === 'function' ? config.hasBottomAxis(data) : config.hasBottomAxis;\n          if (hasBottomAxis) {\n            drawXAxis('bottom');\n          }\n\n          zoom.size([config.width, height]);\n\n          graph.select('.graph-body').remove();\n          var graphBody = graph\n            .append('g')\n            .classed('graph-body', true)\n            .attr('transform', 'translate(' + config.margin.left + ', ' + (config.margin.top - 15) + ')');\n\n          var lines = graphBody.selectAll('g').data(data);\n\n          lines.enter()\n            .append('g')\n            .classed('line', true)\n            .attr('transform', function(d) {\n              return 'translate(0,' + yScale(d.name) + ')';\n            })\n            .style('fill', config.eventColor)\n            .call(eventLine({xScale: xScale}))\n          ;\n\n          lines.exit().remove();\n        }\n\n        redraw();\n        if (config.delimiter) {\n          redrawDelimiter();\n        }\n      });\n    }\n\n    configurable(eventDropGraph, config);\n\n    return eventDropGraph;\n  };\n}\n","\"use strict\";\n\nvar configurable = require('./util/configurable');\nvar filterData = require('./filterData');\n\nvar defaultConfig = {\n  xScale: null\n};\n\nmodule.exports = function (config) {\n\n  config = config || {};\n  for (var key in defaultConfig) {\n    config[key] = config[key] || defaultConfig[key];\n  };\n\n  var eventLine = function eventLine(selection) {\n    selection.each(function (data) {\n      d3.select(this).selectAll('text').remove();\n\n      d3.select(this).append('text')\n        .text(function(d) {\n          var count = filterData(d.dates, config.xScale).length;\n          return d.name + (count > 0 ? ' (' + count + ')' : '');\n        })\n        .attr('text-anchor', 'end')\n        .attr('transform', 'translate(-20)')\n        .style('fill', 'black')\n      ;\n\n      d3.select(this).selectAll('circle').remove();\n\n      var circle = d3.select(this).selectAll('circle')\n        .data(function(d) {\n          // filter value outside of range\n          return filterData(d.dates, config.xScale);\n        });\n\n      circle.enter()\n        .append('circle')\n        .attr('cx', function(d) {\n          return config.xScale(d);\n        })\n        .attr('cy', -5)\n        .attr('r', 10)\n      ;\n\n      circle.exit().remove();\n\n    });\n  };\n\n  configurable(eventLine, config);\n\n  return eventLine;\n};\n","module.exports = function configurable(targetFunction, config, listeners) {\n  listeners = listeners || {};\n  for (var item in config) {\n    (function(item) {\n      targetFunction[item] = function(value) {\n        if (!arguments.length) return config[item];\n        config[item] = value;\n        if (listeners.hasOwnProperty(item)) {\n          listeners[item](value);\n        }\n\n        return targetFunction;\n      };\n    })(item); // for doesn't create a closure, forcing it\n  }\n};\n","\"use strict\";\n\nvar configurable = require('./util/configurable');\n\nvar defaultConfig = {\n  xScale: null,\n  dateFormat: null\n};\n\nmodule.exports = function (config) {\n\n  config = config || {};\n  for (var key in defaultConfig) {\n    config[key] = config[key] || defaultConfig[key];\n  };\n\n  function delimiter(selection) {\n    selection.each(function (data) {\n      d3.select(this).selectAll('text').remove();\n\n      var limits = config.xScale.domain();\n\n      d3.select(this).append('text')\n        .text(function () {\n\n          return config.dateFormat(limits[0]);\n        })\n        .classed('start', true)\n      ;\n\n      d3.select(this).append('text')\n        .text(function () {\n\n          return config.dateFormat(limits[1]);\n        })\n        .attr('text-anchor', 'end')\n        .attr('transform', 'translate(' + config.xScale.range()[1] + ')')\n        .classed('end', true)\n      ;\n    });\n  }\n\n  configurable(delimiter, config);\n\n  return delimiter;\n};\n","\"use strict\";\n\nmodule.exports = function filterDate(data, scale) {\n  data = data || [];\n  var filteredData = [];\n  var boundary = scale.range();\n  var min = boundary[0];\n  var max = boundary[1];\n  data.forEach(function (datum) {\n    var value = scale(datum);\n    if (value < min || value > max) {\n      return;\n    }\n    filteredData.push(datum);\n  });\n\n  return filteredData;\n};\n"]}