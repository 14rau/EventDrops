<!DOCTYPE html>
<meta charset="utf-8">
<html>
    <head>
        <link rel="stylesheet" href="../css/style.css" />
    </head>
    <body>
        <label for="delimiter">delimiter:</label>
        <input name="delimiter" type="checkbox" checked="true" onchange="updateDelimiter()">
        <button onclick="addLine()">Add line</button>
        <button onclick="removeLine()">Remove line</button>
        <script src="../node_modules/d3/d3.js"></script>
        <script src="../src/eventDrops.js"></script>
        <script>
            var body = document.getElementsByTagName('body')[0];

            var data = [];
            var endTime = Date.now();
            var oneMonth = 30 * 24 * 60 * 60 * 1000;
            var startTime = endTime - oneMonth;

            function createEvent (name) {
                var event = {};
                event.name = name;
                event.dates = [];

                var max =  Math.floor(Math.random() * 100);
                for (var j = 0; j < max; j++) {
                    var time = Math.floor((Math.random() * oneMonth)) + startTime;
                    event.dates.push(new Date(time));
                }

                return event;
            }

            for (var i = 1; i <= 10; i++) {

                data.push(createEvent("sample " + i));
            }

            var color = d3.scale.category20();

            var locale = d3.locale({
                "decimal": ",",
                "thousands": " ",
                "grouping": [3],
                "dateTime": "%A %e %B %Y, %X",
                "date": "%d/%m/%Y",
                "time": "%H:%M:%S",
                "periods": ["AM", "PM"],
                "days": ["dimanche", "lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi"],
                "shortDays": ["dim.", "lun.", "mar.", "mer.", "jeu.", "ven.", "sam."],
                "months": ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"],
                "shortMonths": ["janv.", "févr.", "mars", "avril", "mai", "juin", "juil.", "août", "sept.", "oct.", "nov.", "déc."]
            });

            var graph = d3.chart.eventDrops({
                start: new Date(startTime),
                end: new Date(endTime),
                locale: locale,
                // tickFormat: tickFormat,
                eventColor: function (d, i) {
                    return color(i);
                }
            });

            var element = d3.select(body).append('div').datum(data);
            graph(element);

            var defaultDelimiter = graph.delimiter();
            var updateDelimiter = function (value) {
                if (graph.delimiter()) {
                    graph.delimiter(null);
                } else {
                    graph.delimiter(defaultDelimiter);
                }
                graph(element);
            }

            var addLine = function () {
                var data = element.datum();
                var i = data.length + 1;
                data.push(createEvent('sample ' + i));
                elements = element.datum(data);
                graph(element);
            }

            var removeLine = function () {
                var data = element.datum();
                data.pop();
                element = element.datum(data);
                graph(element);
            }

        </script>
    </body>
</html>
